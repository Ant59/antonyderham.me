<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Dealing with file inputs in Angular 6</title><style>html body{font-family:raleway,sans-serif;background-color:#fff}:root{--accent: #9C27B0;--border-width:  5px }</style><link rel=stylesheet href=https://antonyderham.me/css/main.css><link rel=stylesheet href=/css/figures.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script>$(document).on('click',function(){$('.collapse').collapse('hide');})</script><meta name=generator content="Hugo 0.74.2"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-111367451-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)};gtag('js',new Date());gtag('config','UA-111367451-1');</script></head><body><nav class="navbar navbar-default navbar-fixed-top"><div class=container><div class=navbar-header><a class="navbar-brand visible-xs" href=#>Dealing with file inputs in Angular 6</a>
<button class=navbar-toggle data-target=.navbar-collapse data-toggle=collapse>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li><li><a href=/project/>Projects</a></li></ul><ul class="nav navbar-nav navbar-right"><li class=navbar-icon><a href=mailto:antony@derham.me><i class="fa fa-envelope-o"></i></a></li><li class=navbar-icon><a href=https://github.com/ant59/><i class="fa fa-github"></i></a></li><li class=navbar-icon><a href=https://twitter.com/antonyderham/><i class="fa fa-twitter"></i></a></li><li class=navbar-icon><a href=https://www.linkedin.com/in/antonyderham/><i class="fa fa-linkedin"></i></a></li></ul></div></div></nav><main><div class=item><h4><a href=/post/angular-file-input/>Dealing with file inputs in Angular 6</a></h4><h5>June 1, 2018</h5><kbd class=item-tag>angular</kbd> <kbd class=item-tag>form</kbd> <kbd class=item-tag>input</kbd> <kbd class=item-tag>file</kbd> <kbd class=item-tag>directive</kbd> <kbd class=item-tag>control</kbd> <kbd class=item-tag>accessor</kbd> <kbd class=item-tag>upload</kbd></div><br><div class=text-justify><p>File inputs are strange. The value attribute on most inputs behaves as expected, giving the value of the field. HTML defines the <code>value</code> attribute on file inputs as &ldquo;the path of the first file selected&rdquo; (<a href=https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file#Value>see MDN</a>), not the file(s) itself. The selected files are found on the <code>files</code> attribute as a FileList. The leads to some issues with Angular when using forms. Angular has the concept of a <code>ControlValueAccessor</code> (<a href=https://github.com/angular/angular/blob/0cb4f12a7a57087ec4e8329a04d5dfc430764b45/packages/forms/src/directives/default_value_accessor.ts#L59>default implementation</a>). The default accessor uses the <code>value</code> attribute. To get at the file itself, you&rsquo;ll need a custom value accessor.</p><p>The <code>ControlValueAccessor</code> is just an interface for a directive. You can create a new directive for accessing the file on a file input field and provide it with the <code>NG_VALUE_ACCESSOR</code> token.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Directive</span>, <span style=color:#a6e22e>HostListener</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>NG_VALUE_ACCESSOR</span>, <span style=color:#a6e22e>ControlValueAccessor</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@angular/forms&#39;</span>;

<span style=color:#66d9ef>@Directive</span>({
  <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;input[type=file]&#39;</span>,
  <span style=color:#a6e22e>providers</span><span style=color:#f92672>:</span> [
    { <span style=color:#a6e22e>provide</span>: <span style=color:#66d9ef>NG_VALUE_ACCESSOR</span>, <span style=color:#a6e22e>useExisting</span>: <span style=color:#66d9ef>FileValueAccessor</span>, <span style=color:#a6e22e>multi</span>: <span style=color:#66d9ef>true</span> }
  ]
})
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FileValueAccessor</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>ControlValueAccessor</span> {
  <span style=color:#66d9ef>@HostListener</span>(<span style=color:#e6db74>&#39;change&#39;</span>, [<span style=color:#e6db74>&#39;$event.target.files&#39;</span>]) <span style=color:#a6e22e>onChange</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>_</span>: <span style=color:#66d9ef>any</span>) <span style=color:#f92672>=&gt;</span> { };
  <span style=color:#66d9ef>@HostListener</span>(<span style=color:#e6db74>&#39;blur&#39;</span>) <span style=color:#a6e22e>onTouched</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> { };

  <span style=color:#a6e22e>writeValue</span>(<span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>any</span>) { }
  <span style=color:#a6e22e>registerOnChange</span>(<span style=color:#a6e22e>fn</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>_</span>: <span style=color:#66d9ef>any</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>void</span>) { <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>onChange</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fn</span>; }
  <span style=color:#a6e22e>registerOnTouched</span>(<span style=color:#a6e22e>fn</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>void</span>) { <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>onTouched</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fn</span>; }
}
</code></pre></div><p>Once imported to your NgModule, file inputs will start providing the file object on their <code>files</code> attribute to Angular forms and the <code>valueChanges</code> items will be the selected file. The selector for the directive <code>input[type=file]</code> ensures this directive applies only to file input fields. The <code>'$event.target.files'</code> property selector in the change host listener specifies the <code>files</code> attribute value should be given when this event is emitted instead of the default.</p><p>StackBlitz link to working example: <a href=https://stackblitz.com/edit/angular-file-input-value-accessor>https://stackblitz.com/edit/angular-file-input-value-accessor</a></p></div><h4 class=page-header>Related</h4><div class=item><h4><a href=/post/angular-ngrx-auth-interceptor/>Using NgRx Store Auth Token with Angular HttpInterceptor</a></h4><h5>June 4, 2018</h5><kbd class=item-tag>angular</kbd> <kbd class=item-tag>ngrx</kbd> <kbd class=item-tag>store</kbd> <kbd class=item-tag>auth</kbd> <kbd class=item-tag>jwt</kbd> <kbd class=item-tag>http</kbd> <kbd class=item-tag>httpclient</kbd> <kbd class=item-tag>interceptor</kbd> <kbd class=item-tag>httpinterceptor</kbd></div><div class=item><h4><a href=/post/jenkins-docker-pipelines/>Declarative Jenkins Docker Pipeline for Angular CLI applications</a></h4><h5>January 1, 2018</h5><kbd class=item-tag>jenkins</kbd> <kbd class=item-tag>docker</kbd> <kbd class=item-tag>angular</kbd> <kbd class=item-tag>pipeline</kbd></div><h4 class=page-header>Comments</h4><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"antonyderham"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></main><footer><p class="copyright text-muted">Â© All rights reserved. Powered by <a href=https://gohugo.io>Hugo</a> and <a href=https://github.com/calintat/minimal>Minimal</a></p></footer></body></html>